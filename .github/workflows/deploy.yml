name: Deploy to Render

on:
  push:
    branches:
      - main
      - staging

jobs:
  deploy:
    name: Trigger Render Deploy
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Determine environment
        id: env
        run: |
          if [ "${{ github.ref }}" == "refs/heads/main" ]; then
            echo "environment=production" >> $GITHUB_OUTPUT
            echo "backend_hook=${{ secrets.RENDER_DEPLOY_HOOK_BACKEND_PROD }}" >> $GITHUB_OUTPUT
            echo "frontend_hook=${{ secrets.RENDER_DEPLOY_HOOK_FRONTEND_PROD }}" >> $GITHUB_OUTPUT
          else
            echo "environment=staging" >> $GITHUB_OUTPUT
            echo "backend_hook=${{ secrets.RENDER_DEPLOY_HOOK_BACKEND_STAGING }}" >> $GITHUB_OUTPUT
            echo "frontend_hook=${{ secrets.RENDER_DEPLOY_HOOK_FRONTEND_STAGING }}" >> $GITHUB_OUTPUT
          fi

      - name: Deploy Backend to Render
        run: |
          curl -X POST "${{ steps.env.outputs.backend_hook }}"

      - name: Deploy Frontend to Render
        run: |
          curl -X POST "${{ steps.env.outputs.frontend_hook }}"

      - name: Notify deployment
        run: |
          echo "Deployed to ${{ steps.env.outputs.environment }}"
